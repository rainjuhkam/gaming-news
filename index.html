<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gaming News</title>

<style>
:root { color-scheme: dark; }

body{
  margin:0;
  background:#000;
  color:#e5e5e7;
  font-family:-apple-system,BlinkMacSystemFont,system-ui;
}

.card{margin-bottom:22px;}
img{width:100%;aspect-ratio:16/9;object-fit:cover;}
.content{padding:14px;}

.title{
  font-size:18px;
  font-weight:600;
  color:#fff;
}

.meta{
  font-size:13px;
  color:#9a9a9c;
  margin-top:6px;
}

#reader{
  display:none;
  padding:20px 16px 100px;
}

.articlePage{
  max-width:42em;
  margin:0 auto;
}

.articlePage h2{
  font-size:26px;
  margin:16px 0 22px;
}

.articlePage p{
  font-size:19px;
  line-height:1.75;
  color:#d1d1d6;
  margin-bottom:1.3em;
}

#backBtn{
  position:fixed;
  bottom:16px;
  left:16px;
  right:16px;
  padding:16px;
  font-size:17px;
  background:#1c1c1e;
  color:#fff;
  border:1px solid #2c2c2e;
  border-radius:14px;
}

#loadMore{
  margin:30px 16px 50px;
  padding:18px;
  font-size:17px;
  background:#1c1c1e;
  color:#fff;
  border:1px solid #2c2c2e;
  border-radius:14px;
  text-align:center;
}
</style>
</head>

<body>

<div id="feed"></div>

<div id="reader">
  <div class="articlePage" id="articleContent"></div>
  <button id="backBtn" onclick="backToFeed()">⬅︎ Back to feed</button>
</div>

<script>

const feeds = [
  { url:"https://feeds.ign.com/ign/all", name:"IGN" },
  { url:"https://www.pcgamer.com/rss/", name:"PC Gamer" },
  { url:"https://www.eurogamer.net/feed", name:"Eurogamer" },
  { url:"https://kotaku.com/rss", name:"Kotaku" },
  { url:"https://www.polygon.com/rss/index.xml", name:"Polygon" }
];

let dayOffset = 0;
let scrollPos = 0;

function isSameDay(d1,d2){
  return d1.getFullYear()===d2.getFullYear() &&
         d1.getMonth()===d2.getMonth() &&
         d1.getDate()===d2.getDate();
}

async function fetchFeed(feed){

  const url = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(feed.url);
  const res = await fetch(url);
  const data = await res.json();

  return data.items.map(item=>({
    title:item.title,
    source:feed.name,
    date:new Date(item.pubDate),
    image:item.thumbnail || null,
    content:item.content
  }));
}

async function loadDay(offset){

  const target = new Date();
  target.setHours(0,0,0,0);
  target.setDate(target.getDate()-offset);

  let all = [];

  for(const feed of feeds){
    try{
      const items = await fetchFeed(feed);
      all = all.concat(items);
    }catch{}
  }

  return all
    .filter(a=>isSameDay(a.date,target))
    .sort((a,b)=>b.date-a.date);
}

function renderCard(article){

  const time = article.date.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});

  return `
    <div class="card" onclick='openArticle(${JSON.stringify(article)})'>
      ${article.image ? `<img src="${article.image}">` : ""}
      <div class="content">
        <div class="title">${article.title}</div>
        <div class="meta">${article.source} · ${time}</div>
      </div>
    </div>
  `;
}

function openArticle(article){
  scrollPos = window.scrollY;

  document.getElementById("feed").style.display="none";
  document.getElementById("reader").style.display="block";

  document.getElementById("articleContent").innerHTML =
    (article.image ? `<img src="${article.image}">` : "") +
    `<h2>${article.title}</h2>` +
    article.content;

  window.scrollTo(0,0);
}

function backToFeed(){
  document.getElementById("reader").style.display="none";
  document.getElementById("feed").style.display="block";
  window.scrollTo(0,scrollPos);
}

async function init(){
  const articles = await loadDay(dayOffset);
  const feed = document.getElementById("feed");

  articles.forEach(a=>{
    feed.insertAdjacentHTML("beforeend", renderCard(a));
  });

  feed.insertAdjacentHTML("beforeend",
    `<div id="loadMore" onclick="loadPrevious()">Load previous day</div>`
  );
}

async function loadPrevious(){
  dayOffset++;
  const articles = await loadDay(dayOffset);

  const loadBtn = document.getElementById("loadMore");

  articles.forEach(a=>{
    loadBtn.insertAdjacentHTML("beforebegin", renderCard(a));
  });
}

init();

</script>
</body>
</html>
